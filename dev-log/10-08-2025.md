# MySQL Setup

## Start, Stop, and Check Status (Terminal)
```bash
sudo mysql.server start    # Start MySQL server
sudo mysql.server stop     # Stop MySQL server
sudo mysql.server status   # Check MySQL server status
```
`sudo`  runs the command with administrative privileges. 
## Start MySQL Client
1. Make sure the MySQl server is running.
2. Run: `mysql -u root`.
3. Enter the password you set for the root user.
4. The prompt will change to: `mysql>`, you can now enter MySQL commands.
5. To quit, type: `quit` or `exit`.
6. If, for some reason, mysql won't start, try Stop/Start cleanly
   ``` bash
   mysqladmin -uroot -p shutdown
   sudo mysql.server start
   ```
7. **Note** Don't start mysql in the terminal, just open mysql workbench, and it will start mysql.

# MyBatis fundamentals
## core component
- **SqlSessionFactory:**  Factory class used to create SqlSession instances.
- **SqlSession:** Core MyBatis object used to execute SQL statements on the database.
- **main configuration file:** XML file used to configure MyBatis settings.
- **Mapper Interface (DAO Interface):** DAO socket, called Mapper in MyBatis by convention
- **Mapper Implementation:** Contains the SQL statements and maps them to Java objects. Implemented via XML or annotations.

### Load MySQL dependencies into community maven project
**Steps:**  
1. Go to https://mvnrepository.com/artifact/com.mysql/mysql-connector-j 
2. Check the latest available version.
3. Update your `<version>` tag in porm.xml to that version.
   ```xml
           <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
            <version>9.4.0</version>
        </dependency>
   ```
4. Reload Maven in your IDE  
   - In IntelliJ, go to View > Tool Windows > Maven
   - Once the Maven window opens (usually docks on teh right), you will see your project listed.
   - At the top of that Maven panel, click the refresh icon ðŸ”„ (hover text: Reload All Maven Project).

### Load MyBatis dependencies for Spring Boot 
```xml
<!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter -->
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>3.0.5</version>
</dependency>
```
follow the same steps above.

### Set up MySQL configurations in `application.properties`.
```properties
# ==============================
# DataSource Properties
# ==============================

# JDBC driver for MySQL
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JDBC connection URL
# - characterEncoding=utf-8 : Use UTF-8 character set
# - useSSL=false : Disable SSL (for local development)
# - serverTimezone=Europe/Dublin : Set timezone to Ireland
spring.datasource.url=jdbc:mysql://localhost:3306/community?characterEncoding=utf-8&useSSL=false&serverTimezone=Europe/Dublin

# Database username 
spring.datasource.username=root

# Database password 
spring.datasource.password=5TrGn555

# DataSource implementation
# HikariCP is the default high-performance connection pool in Spring Boot
spring.datasource.type=com.zaxxer.hikari.HikariDataSource

# ==============================
# HikariCP Connection Pool Settings
# ==============================

# Maximum number of connections in the pool
spring.datasource.hikari.maximum-pool-size=15

# Minimum number of idle connections to keep in the pool
spring.datasource.hikari.minimum-idle=5

# Maximum idle time (in milliseconds) before an idle connection is removed from the pool
spring.datasource.hikari.idle-timeout=30000
```

### Set up MyBatis configuration in `application.properties`.
```properties
# ==============================
# MyBatis Properties
# ==============================

# MyBatis Mapper acts as a "translator" â€” it converts Java method calls 
# into SQL commands (in a format MySQL understands), executes them, 
# and maps the results back into Java objects.
#
# This property specifies the location of MyBatis mapper XML files.
# The 'classpath:' prefix means the search starts from the resources directory.
# Here, it will load all XML files under src/main/resources/mapper/.
mybatis.mapper-locations=classpath:mapper/*.xml

# The 'entity' package contains POJO (Plain Old Java Object) classes, 
# such as the User class, where each field corresponds to a column 
# in the MySQL `user` table. 
# MyBatis uses these classes to map database rows to Java objects 
# and vice versa, enabling object-oriented access to data.
#
# Package containing entity classes (POJOs/Plain Old Java Object) for MyBatis type aliases
# Allows using class names directly in mapper XML without full package name.
mybatis.type-aliases-package=com.haoshe.community.entity

# NOTE:
# Based on these configurations, you need to create:
# - Directory for mapper XML files: src/main/resources/mapper
# - Java package for entity classes: com.haoshe.community.entity

# Enable JDBC's getGeneratedKeys() support for auto-increment primary keys
# This lets MyBatis automatically retrieve database-generated keys after INSERT.
mybatis.configuration.useGeneratedKeys=true

# Enable automatic mapping from database column names with underscores
# to Java camelCase property names (e.g., user_name â†’ userName)
mybatis.configuration.mapUnderscoreToCamelCase=true
```



# Step-by-step MyBatis Workflow

## 1) Create the POJO (`User` class)
- Represents a **row** in the `user` table.
- Each field in the `User` class corresponds to a **column** in MySQL.
- MyBatis maps **query results** into this class and uses its fields as **SQL parameters** for insert/update.

---

## 2) Create the Mapper Interface (`UserMapper.java`)
- A **Java interface** with abstract methods (no implementation).
- **Method names/signatures** should match the SQL mappings in the XML.

```java
public interface UserMapper {
    User selectById(int id);
    int insertUser(User user);
}
```
## 3) Create the Mapper XML (`user-mapper.xml`)

- The `<mapper namespace="...">` links this XML file to your `UserMapper` interface.
- Inside the XML, write the **actual SQL** for each method defined in the interface.
- The `id` attribute of `<select>`, `<insert>`, etc., **must match** the corresponding interface method name.
``` xml
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.haoshe.community.dao.UserMapper">

    <select id="selectById" resultType="User">
        SELECT * FROM user WHERE id = #{id}
    </select>

    <insert id="insertUser" parameterType="User">
        INSERT INTO user (username, email) VALUES (#{username}, #{email})
    </insert>

</mapper>
```
> **Note:**  
> `resultType="User"` and `parameterType="User"` work if youâ€™ve set:  
> `mybatis.type-aliases-package=com.haoshe.community.entity`
> otherwise, you have to write the full path `com.haoshe.community.entity.User`
## 4) Execution Flow

1. Obtain or inject a `UserMapper` instance via MyBatis.
2. Call `userMapper.selectById(1)`.
3. MyBatis:
    - Finds the matching `<select id="selectById">` in `user-mapper.xml`.
    - Executes the SQL on the MySQL database.
    - Maps the result to a `User` object and returns it.
``` java
public class MapperTests {
    @Autowired
    private UserMapper userMapper;

    @Test
    public void testSelectUser(){
        User user = userMapper.selectById(101);
        System.out.println(user);
    }
}
```
## Debug Logging

To enable detailed logging for your application code,  
add the following line to `src/main/resources/application.properties`:

```properties
# Sets the logging level to DEBUG for all classes in the package com.haoshe.community
# DEBUG level logs provide verbose output useful for troubleshooting and development.
# This setting will NOT affect classes outside this package.
logging.level.com.haoshe.community=debug
```
**Note:** Use `DEBUG` only during development or when diagnosing issues, as it can generate a large amount of log output.



   


